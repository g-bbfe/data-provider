{"version":3,"sources":["../src/CacheData.js"],"names":["_ins","CacheData","ns","signature","isMemory","id","storage","clear","key","opts","CacheDataItem","maxAge","maxage","ignoreExpires","dataFormatter","getter","setter","data","value","time","Date","getTime","expires","set","get","remove"],"mappings":"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","file":"CacheData.js","sourcesContent":["import Storage from  './storage/Storage' ;\nvar _ins = {};\n\n\nclass CacheData {\n\n    constructor(ns, signature = '', isMemory = false) {\n\n        let id = ns + \"_\" + signature;\n        // Singleton Pattern\n        if (!(_ins[id] instanceof CacheData)) {\n            _ins[id] = this;\n        } else {\n            return _ins[id];\n        }\n\n        this.id = id;\n        this.signature = signature;\n        //CacheData中只采取持久存储方案\n        this.storage = new Storage(ns, isMemory);\n    }\n\n    clear() {\n        this.storage.clear();\n    };\n\n    item(key, opts) {\n        opts = opts || {};\n        return new CacheDataItem(this.storage, this.signature, key, opts);\n    };\n\n}\n\nclass CacheDataItem {\n\n    constructor(storage, signature, key, opts) {\n\n        // eg: url+参数序列化\n        this.key = key;\n        // 就是具体的存储方案， 调用它来clear, get , set\n        this.storage = storage;\n        // eg, v2.0\n        this.signature = signature;\n\n        this.maxAge = opts.maxAge || opts.maxage || null;\n\n        this.ignoreExpires = opts.ignoreExpires;\n\n        this.dataFormatter = {\n            getter: null,\n            setter: null\n        }\n\n    }\n\n    setFormatter(setter, getter) {\n        this.dataFormatter = {\n            setter: setter || null,\n            getter: getter || null\n        }\n    }\n\n    set(data) {\n        if (this.dataFormatter && this.dataFormatter.setter) {\n            data = this.dataFormatter.setter(data);\n        }\n        var value = {\n            data: data,\n            time: (new Date()).getTime(),\n            signature: this.signature\n        }\n        if (this.maxAge) {\n            value.expires = (new Date()).getTime() + this.maxAge;\n        }\n        if (value.data) {\n            this.storage.set(this.key, value);\n        }\n    }\n\n    get() {\n        var data = this.storage.get(this.key);\n        if (data && data.signature === this.signature && (this.ignoreExpires || !data.expires || (new Date()).getTime() < data.expires)) {\n            data = data.data;\n\n            if (this.dataFormatter && this.dataFormatter.getter) {\n                data = this.dataFormatter.getter(data);\n            }\n            return data;\n        }\n        return null;\n    }\n\n    remove() {\n        this.storage.remove(this.key);\n    }\n\n    isExpired() {\n        var data = this.storage.get(this.key);\n        return !!data && !!data.expires && (new Date()).getTime() >= data.expires;\n    }\n\n    getUpdatedTime() {\n        var data = this.storage.get(this.key);\n        return data && (data.time - 0);\n    }\n\n    getExpires() {\n        var data = this.storage.get(this.key);\n        return data && data.expires;\n    }\n\n}\n\nexport default CacheData;\n"]}